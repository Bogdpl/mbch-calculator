<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ä–µ–¥ –ú–ë–ß</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* -------------------------------- */
/*            –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò       */
/* -------------------------------- */

body {
    font-family: Arial;
    padding: 20px;
    max-width: 750px;
    margin: auto;
    background: #ffffff;
    color: #000000;
    transition: 0.3s;
    position: relative;
}

/* —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark-mode {
    background: #1a1a1a;
    color: #e6e6e6;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
h2 {
    text-align: center;
    margin-top: 15px;
    margin-bottom: 20px;
}

/* -------------------------------- */
/*    –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú–´ (–ù–û–í–´–ô)     */
/* -------------------------------- */

.theme-toggle {
    position: absolute;
    left: 0;
    top: 15px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: rgba(0,0,0,0.1);
    color: #333;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ ‚Äî –∏–∫–æ–Ω–∫–∞ —Å–µ—Ä–æ–≤–∞—Ç–∞—è */
body:not(.dark-mode) .theme-toggle {
    background: rgba(0,0,0,0.1);
    color: #444;
    border-color: rgba(0,0,0,0.3);
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ ‚Äî –±–µ–ª–∞—è –∏–∫–æ–Ω–∫–∞ */
body.dark-mode .theme-toggle {
    background: rgba(255,255,255,0.15);
    color: #fff;
    border-color: rgba(255,255,255,0.5);
}

/* –°–∫—Ä—É–≥–ª–µ–Ω–∏—è */
.block, table, button, input, select {
    border-radius: 20px;
}

.block {
    padding: 15px;
    border: 1px solid #ccc;
    margin-bottom: 20px;
    transition: 0.3s;
}

body.dark-mode .block {
    border-color: #555;
}

/* -------------------------------- */
/*        –ü–ï–†–í–ê–Ø –ü–†–û–ë–ê ‚Äî INPUT       */
/* -------------------------------- */

input[type=text] {
    padding: 14px 18px;
    border-radius: 16px;
    border: 1px solid #aaa;
    width: calc(100% - 35px);   /* —É–º–µ–Ω—å—à–µ–Ω–æ –Ω–∞ 35px */
    font-size: 16px;
    text-align: left;
    margin-top: 15px;
    transition: 0.3s;
}

body.dark-mode input[type=text] {
    background: #333;
    border-color: #666;
    color: #fff;
}

input[type=text]::placeholder {
    color: rgba(0,0,0,0.3);
}

body.dark-mode input[type=text]::placeholder {
    color: rgba(255,255,255,0.25);
}

/* –ò–º–µ–Ω–∞ –ø—Ä–æ–± */
input.probe-name {
    width: 120px;
    padding: 6px 10px;
    border-radius: 12px;
    border: 1px solid #aaa;
    text-align: center;
    transition: 0.3s;
}

body.dark-mode input.probe-name {
    background: #333;
    border-color: #666;
    color: #fff;
}

/* -------------------------------- */
/*   –ü–õ–Æ–° / –ú–ò–ù–£–°                   */
/* -------------------------------- */

.counter {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 18px;
}

.counter button {
    width: 28px;
    height: 28px;
    font-size: 18px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: transparent;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}

body.dark-mode .counter button {
    border-color: rgba(255,255,255,0.3);
    color: #f0f0f0;
}

/* -------------------------------- */
/*            –¢–ê–ë–õ–ò–¶–ê               */
/* -------------------------------- */

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
    transition: 0.3s;
}

body.dark-mode th, 
body.dark-mode td {
    border-color: #555;
}

/* –û–¢–°–¢–£–ü –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ –∫–Ω–æ–ø–∫–æ–π */
table + .calculate-btn {
    margin-top: 15px;
}

/* -------------------------------- */
/*       –ö–ù–û–ü–ö–ò                     */
/* -------------------------------- */

button.calculate-btn {
    width: 100%;
    padding: 12px;
    background: #2d7dff;
    color: white;
    border: none;
    font-size: 18px;
    transition: 0.3s;
}

button.export-btn {
    width: 100%;
    padding: 12px;
    background: rgba(0,180,0,0.3);
    color: #004d00;
    border: none;
    font-size: 18px;
    margin-top: 10px;
    transition: 0.3s;
}

body.dark-mode button.export-btn {
    background: rgba(0,255,0,0.18);
    color: #66ff66;
}

/* -------------------------------- */
/*       –ö–†–ï–°–¢–ò–ö                    */
/* -------------------------------- */

.delete-btn {
    background: none;
    border: none;
    color: red;
    font-size: 20px;
    cursor: pointer;
}

body.dark-mode .delete-btn {
    color: #ff6666;
}

/* -------------------------------- */
/*           –ò–¢–û–ì–ò                  */
/* -------------------------------- */

.total-line {
    padding: 3px 0;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid rgba(0,0,0,0.2);
    margin-bottom: 6px;
}

body.dark-mode .total-line {
    border-bottom-color: rgba(255,255,255,0.2);
}

</style>
</head>
<body>

<!-- –ù–æ–≤—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
<button class="theme-toggle" onclick="toggleTheme()">üåô</button>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ä–µ–¥ –ú–ë–ß</h2>

<div class="block">
    <h3 style="text-align:center;">–ü–µ—Ä–≤–∞—è –ø—Ä–æ–±–∞</h3>
    <input type="text" id="firstProbe" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: FP-1856">
</div>

<div class="block">
    <h3 style="text-align:center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±</h3>

    <div class="counter">
        <button onclick="changeCount(-1)">‚àí</button>
        <input type="number" id="sampleCount" value="0" min="0"
               oninput="updateRows()" style="width:60px;text-align:center;font-size:18px;">
        <button onclick="changeCount(1)">+</button>
    </div>
</div>

<table id="samplesTable">
    <thead>
        <tr>
            <th></th>
            <th>#</th>
            <th>–ü—Ä–æ–±–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>1:100</th>
            <th>1:1000</th>
            <th>FBR</th>
            <th>TSA</th>
            <th>SDA</th>
            <th>TSB</th>
            <th>Mossel</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button class="calculate-btn" onclick="calculateAll()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button class="export-btn" onclick="exportExcel()">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</button>

<h3 style="margin-top:25px;">–ò–¢–û–ì–û:</h3>

<div class="total-line">FBR <span id="sum_fbr">0</span> –º–ª</div>
<div class="total-line">TSA <span id="sum_tsa">0</span> –º–ª</div>
<div class="total-line">SDA <span id="sum_sda">0</span> –º–ª</div>
<div class="total-line">TSB <span id="sum_tsb">0</span> –º–ª</div>
<div class="total-line">Mossel/MacConkey <span id="sum_mossel">0</span> –º–ª</div>

<script>

/* ---------- THEME SWITCH ---------- */

function toggleTheme() {
    document.body.classList.toggle("dark-mode");

    const btn = document.querySelector(".theme-toggle");
    btn.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
}

/* ---------- –ü–†–û–ë–´ ---------- */

function parseProbeName(name) {
    let match = name.match(/^([A-Za-z]+)-?(\d+)$/);
    if (!match) return null;
    return { prefix: match[1], number: parseInt(match[2]) };
}

function generateProbeName(startName, offset) {
    let parsed = parseProbeName(startName);
    if (!parsed) return startName;
    return parsed.prefix + "-" + (parsed.number + offset);
}

function changeCount(delta) {
    let el = document.getElementById("sampleCount");
    let count = Number(el.value) + delta;
    if (count < 0) count = 0;
    el.value = count;
    updateRows();
}

function updateRows() {
    const tbody = document.querySelector("#samplesTable tbody");
    let target = Number(document.getElementById("sampleCount").value);
    let current = tbody.children.length;

    while (current < target) addRow(current++);
    while (current > target) tbody.removeChild(tbody.lastElementChild), current--;

    renumberRows();
}

function addRow(index) {
    const tbody = document.querySelector("#samplesTable tbody");
    const row = document.createElement("tr");

    let first = document.getElementById("firstProbe").value.trim();
    let generated = first ? generateProbeName(first, index) : "";

    row.innerHTML = `
        <td><button class="delete-btn" onclick="deleteRow(this)">‚úñ</button></td>
        <td class="rownum"></td>
        <td><input type="text" class="probe-name" value="${generated}"></td>

        <td>
            <select class="cat">
                <option value="2.2">2.2</option>
                <option value="3A">3A</option>
                <option value="4.2">4.2</option>
            </select>
        </td>

        <td><input type="checkbox" class="d100"></td>
        <td><input type="checkbox" class="d1000"></td>

        <td class="fbr">0</td>
        <td class="tsa">0</td>
        <td class="sda">0</td>
        <td class="tsb">0</td>
        <td class="mossel">0</td>
    `;
    tbody.appendChild(row);
}

function deleteRow(btn) {
    btn.closest("tr").remove();
    renumberRows();
    document.getElementById("sampleCount").value =
        document.querySelector("#samplesTable tbody").children.length;
}

function renumberRows() {
    document.querySelectorAll("#samplesTable tbody tr").forEach((row, i) => {
        row.querySelector(".rownum").textContent = i + 1;
    });
}

/* ---------- –†–ê–°–ß–Å–¢ ---------- */

function calculateAll() {
    const rows = document.querySelectorAll("#samplesTable tbody tr");

    let FBR=0, TSA=0, SDA=0, TSB=0, Mossel=0;

    rows.forEach(row => {
        const cat = row.querySelector(".cat").value;
        const d100 = row.querySelector(".d100").checked;
        const d1000 = row.querySelector(".d1000").checked;

        let fbr = 90 + (d100 ? 90 : 0) + (d1000 ? 90 : 0);
        let tsa = 25;
        let sda = 25;
        let tsb = (cat === "4.2" ? 190 : 100);
        let moss = (cat === "4.2" ? 27 : 0);

        row.querySelector(".fbr").textContent = fbr;
        row.querySelector(".tsa").textContent = tsa;
        row.querySelector(".sda").textContent = sda;
        row.querySelector(".tsb").textContent = tsb;
        row.querySelector(".mossel").textContent = moss;

        FBR += fbr;
        TSA += tsa;
        SDA += sda;
        TSB += tsb;
        Mossel += moss;
    });

    sum_fbr.textContent = FBR;
    sum_tsa.textContent = TSA;
    sum_sda.textContent = SDA;
    sum_tsb.textContent = TSB;
    sum_mossel.textContent = Mossel;
}

/* ---------- –≠–ö–°–ü–û–†–¢ ---------- */

function exportExcel() {
    calculateAll();

    let csv =
        "–°—Ä–µ–¥–∞,–º–ª\n" +
        "FBR," + sum_fbr.textContent + "\n" +
        "TSA," + sum_tsa.textContent + "\n" +
        "SDA," + sum_sda.textContent + "\n" +
        "TSB," + sum_tsb.textContent + "\n" +
        "Mossel/MacConkey," + sum_mossel.textContent + "\n";

    let blob = new Blob([csv], {type:"text/csv"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "media_consumption.csv";
    link.click();
}

</script>
</body>
</html>
