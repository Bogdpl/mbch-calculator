<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ú–ë–ß</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---- –ì–õ–ê–í–ù–´–ï –°–¢–ò–õ–ò (–∫–∞–∫ —É —Ç–µ–±—è, –Ω–µ–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ) ---- */

body {
    font-family: Arial;
    padding: 20px;
    max-width: 750px;
    margin: auto;
    background: #ffffff;
    color: #000000;
    transition: 0.3s;
    position: relative;
}
body.dark-mode { background: #1a1a1a; color: #e6e6e6; }

/* –¢–µ–º–∞ ‚Äì —Å–º–µ—â–∞–µ–º –≤–ø—Ä–∞–≤–æ */
.theme-toggle {
    position: absolute;
    left: 40px;
    top: 15px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: rgba(0,0,0,0.1);
    color: #333;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}
body.dark-mode .theme-toggle {
    background: rgba(255,255,255,0.15);
    color: #fff;
    border-color: rgba(255,255,255,0.5);
}

/* –°–∫—Ä—É–≥–ª–µ–Ω–∏—è */
.block, table, button, input, select { border-radius: 20px; }
.block {
    padding: 15px; border: 1px solid #ccc; margin-bottom: 20px;
}
body.dark-mode .block { border-color: #555; }

/* –ò–º—è –ø–µ—Ä–≤–æ–π –ø—Ä–æ–±—ã */
input[type=text] {
    padding: 14px 18px;
    border-radius: 16px;
    border: 1px solid #aaa;
    width: calc(100% - 35px);
    font-size: 16px;
    text-align: left;
    margin-top: 15px;
}
body.dark-mode input[type=text] { background: #333; color: #fff; border-color: #666; }

/* –ò–º—è –ø—Ä–æ–±—ã */
input.probe-name {
    width: 120px; padding: 6px 10px;
    border-radius: 12px; border: 1px solid #aaa;
    text-align: center;
}
body.dark-mode input.probe-name {
    background: #333; color: #fff; border-color: #666;
}

/* –°—á—ë—Ç—á–∏–∫ */
.counter { display: flex; justify-content: center; align-items: center; gap: 18px; }
.counter button {
    width: 28px; height: 28px;
    font-size: 18px; border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: transparent;
}
body.dark-mode .counter button { border-color: rgba(255,255,255,0.3); color: #fff; }

/* –¢–∞–±–ª–∏—Ü–∞ */
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
body.dark-mode th, body.dark-mode td { border-color: #555; }

/* –ö–Ω–æ–ø–∫–∏ */
button.calculate-btn {
    width: 100%; padding: 12px; background: #2d7dff;
    color: white; border: none; font-size: 18px; margin-top: 15px;
}
button.export-btn {
    width: 100%; padding: 12px;
    background: rgba(0,180,0,0.3); color: #004d00;
    border: none; font-size: 18px; margin-top: 10px;
}
body.dark-mode button.export-btn {
    background: rgba(0,255,0,0.18); color: #66ff66;
}

.delete-btn {
    background: none; border: none; color: red;
    font-size: 20px; cursor: pointer;
}
body.dark-mode .delete-btn { color: #ff6666; }

/* –ò—Ç–æ–≥–∏ */
.total-line {
    padding: 3px 0; font-size: 16px;
    display: flex; justify-content: space-between;
    border-bottom: 1px solid rgba(0,0,0,0.2);
    margin-bottom: 6px;
}
body.dark-mode .total-line { border-bottom-color: rgba(255,255,255,0.2); }
</style>
</head>

<body>
<button class="theme-toggle" onclick="toggleTheme()">üåô</button>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ú–ë–ß</h2>

<div class="block">
    <h3 style="text-align:center;">–ü–µ—Ä–≤–∞—è –ø—Ä–æ–±–∞</h3>
    <input type="text" id="firstProbe" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: FP-1856">
</div>

<div class="block">
    <h3 style="text-align:center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±</h3>
    <div class="counter">
        <button onclick="changeCount(-1)">‚àí</button>
        <input type="number" id="sampleCount" value="0" min="0" oninput="updateRows()"
               style="width:60px;text-align:center;font-size:18px;">
        <button onclick="changeCount(1)">+</button>
    </div>
</div>

<table id="samplesTable">
    <thead>
        <tr>
            <th></th>
            <th>#</th>
            <th>–ü—Ä–æ–±–∞</th>
            <th>–§–æ—Ä–º–∞—Ç</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>1:100</th>
            <th>1:1000</th>
            <th>FBR</th>
            <th>TSA</th>
            <th>SDA</th>
            <th>TSB</th>
            <th>Mossel</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button class="calculate-btn" onclick="calculateAll()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button class="export-btn" onclick="exportExcel()">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</button>

<h3 style="margin-top:25px;">–ò–¢–û–ì–û ‚Äî –°—Ä–µ–¥—ã:</h3>

<div class="total-line">FBR <span id="sum_fbr">0</span> –º–ª</div>
<div class="total-line">TSA <span id="sum_tsa">0</span> –º–ª</div>
<div class="total-line">SDA <span id="sum_sda">0</span> –º–ª</div>
<div class="total-line">TSB <span id="sum_tsb">0</span> –º–ª</div>
<div class="total-line">Mossel/MacConkey <span id="sum_mossel">0</span> –º–ª</div>

<h3 style="margin-top:25px;">–ò–¢–û–ì–û ‚Äî –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</h3>

<div class="total-line">–ú–µ–ª—å–Ω–∏—á–∫–∏ <span id="sum_grinders">0</span></div>
<div class="total-line">–ù–æ–∂–Ω–∏—Ü—ã <span id="sum_scissors">0</span></div>
<div class="total-line">–õ–æ–∂–∫–∏ <span id="sum_spoons">0</span></div>
<div class="total-line">–§–ª–∞–∫–æ–Ω—ã –æ–±—ã—á–Ω—ã–µ <span id="sum_bottles">0</span></div>
<div class="total-line">–§–ª–∞–∫–æ–Ω—ã 100 –º–ª <span id="sum_bottles100">0</span></div>
<div class="total-line">–ü—Ä–æ–±–∏—Ä–∫–∏ <span id="sum_tubes">0</span></div>
<div class="total-line">–®—Ç–∞—Ç–∏–≤—ã <span id="sum_racks">0</span></div>
<script>

/* ------------------- –¢–µ–º–∞ ------------------- */
function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    document.querySelector(".theme-toggle").textContent =
        document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
}

/* ---------------- –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç ---------------- */
function detectFormat(probe) {
    if (!probe) return "–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞";
    probe = probe.toUpperCase();

    if (probe.startsWith("PPM") || probe.startsWith("PM")) return "–ù–æ–∂–Ω–∏—Ü—ã (—Ñ–∏–∫—Å.)";
    if (probe.startsWith("FP")) return "–¢–∞–±–ª–µ—Ç–∫–∞";
    if (probe.startsWith("EX")) return "–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞";

    return "–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞";
}

/* ---------------- –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ ---------------- */
function updateAutoFormat(input) {
    const probe = input.value.trim();
    const row = input.closest("tr");
    const formatSel = row.querySelector(".format");

    const detected = detectFormat(probe);

    if (detected === "–ù–æ–∂–Ω–∏—Ü—ã (—Ñ–∏–∫—Å.)") {
        formatSel.innerHTML = `<option selected>–ù–æ–∂–Ω–∏—Ü—ã (—Ñ–∏–∫—Å.)</option>`;
        formatSel.disabled = true;
    } else {
        formatSel.disabled = false;
        formatSel.innerHTML = `
            <option>–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞</option>
            <option>–¢–∞–±–ª–µ—Ç–∫–∞</option>
            <option>–ö–∞–ø—Å—É–ª–∞</option>
            <option>–ü–æ—Ä–æ—à–æ–∫</option>
        `;
        formatSel.value = detected;
    }
}

/* ------------------- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ ------------------- */

function changeCount(d) {
    let el = document.getElementById("sampleCount");
    let v = Number(el.value) + d;
    if (v < 0) v = 0;
    el.value = v;
    updateRows();
}

function updateRows() {
    const tbody = document.querySelector("#samplesTable tbody");
    const need = Number(document.getElementById("sampleCount").value);
    let cur = tbody.children.length;

    while (cur < need) addRow(cur++);
    while (cur > need) { tbody.removeChild(tbody.lastElementChild); cur--; }

    renumber();
}

/* –∏–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ */
function parseProbe(name) {
    let m = name.match(/^([A-Za-z]+)-?(\d+)$/);
    if (!m) return null;
    return { p: m[1], n: Number(m[2]) };
}
function generateProbeName(base, offset) {
    let o = parseProbe(base);
    if (!o) return base;
    return o.p + "-" + (o.n + offset);
}

/* –ù–ê–°–õ–ï–î–û–í–ê–ù–ò–ï —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
function getLastFormatAndCat() {
    const rows = document.querySelectorAll("#samplesTable tbody tr");
    if (rows.length === 0) return { format: "–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞", cat: "2.2" };

    const last = rows[rows.length - 1];

    return {
        format: last.querySelector(".format").value,
        cat: last.querySelector(".cat").value
    };
}

/* –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ */
function addRow(index) {
    const tbody = document.querySelector("#samplesTable tbody");

    const row = document.createElement("tr");

    /* –ø–µ—Ä–≤–∞—è –ø—Ä–æ–±–∞ –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç */
    let first = document.getElementById("firstProbe").value.trim();
    let probeValue = first ? generateProbeName(first, index) : "";

    /* –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ */
    let prev = getLastFormatAndCat();

    row.innerHTML = `
        <td><button class="delete-btn" onclick="deleteRow(this)">‚úñ</button></td>
        <td class="rownum"></td>

        <td><input type="text" class="probe-name"
            value="${probeValue}" oninput="updateAutoFormat(this)"></td>

        <td>
            <select class="format">
                <option>–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑—Ü–∞</option>
                <option>–¢–∞–±–ª–µ—Ç–∫–∞</option>
                <option>–ö–∞–ø—Å—É–ª–∞</option>
                <option>–ü–æ—Ä–æ—à–æ–∫</option>
            </select>
        </td>

        <td>
            <select class="cat">
                <option value="2.2">2.2</option>
                <option value="3A">3A</option>
                <option value="4.2">4.2</option>
                <option value="1.2–ë">1.2–ë</option>
                <option value="1.2–ë+2.2">1.2–ë+2.2</option>
            </select>
        </td>

        <td><input type="checkbox" class="d100"></td>
        <td><input type="checkbox" class="d1000"></td>

        <td class="fbr">0</td>
        <td class="tsa">0</td>
        <td class="sda">0</td>
        <td class="tsb">0</td>
        <td class="mossel">0</td>
    `;

    tbody.appendChild(row);

    /* –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç */
    updateAutoFormat(row.querySelector(".probe-name"));

    /* –ù–ê–°–õ–ï–î–û–í–ê–ù–ò–ï */
    let formatSel = row.querySelector(".format");

    if (!formatSel.disabled) formatSel.value = prev.format;

    row.querySelector(".cat").value = prev.cat;

    renumber();
}

function deleteRow(btn) {
    btn.closest("tr").remove();
    renumber();
    document.getElementById("sampleCount").value =
        document.querySelectorAll("#samplesTable tbody tr").length;
}

function renumber() {
    document.querySelectorAll("#samplesTable tbody tr").forEach((tr, i) => {
        tr.querySelector(".rownum").textContent = i + 1;
    });
}
/* -------------------- –†–ê–°–ß–Å–¢ -------------------- */
function calculateAll() {
    const rows = document.querySelectorAll("#samplesTable tbody tr");

    let totalFBR = 0, totalTSA = 0, totalSDA = 0, totalTSB = 0, totalMoss = 0;

    let grinders = 0, scissors = 0, spoons = 0;
    let bottles = 0, bottles100 = 0;
    let tubes = 0;

    rows.forEach(row => {

        const cat = row.querySelector(".cat").value;
        const d100 = row.querySelector(".d100").checked;
        const d1000 = row.querySelector(".d1000").checked;
        const format = row.querySelector(".format").value;

        /* –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å—Ä–µ–¥ */
        let fbr = 90 + (d100 ? 90 : 0) + (d1000 ? 90 : 0);
        let tsa = 25;
        let sda = 25;

        let tsb = 100;
        let moss = 0;

        if (cat === "4.2") { moss = 27; tsb = 190; }
        if (cat === "1.2–ë" || cat === "1.2–ë+2.2") moss = 100;

        /* —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ */
        totalFBR += fbr; totalTSA += tsa; totalSDA += sda;
        totalTSB += tsb; totalMoss += moss;

        /* –≤—ã–≤–æ–¥ */
        row.querySelector(".fbr").textContent = fbr;
        row.querySelector(".tsa").textContent = tsa;
        row.querySelector(".sda").textContent = sda;
        row.querySelector(".tsb").textContent = tsb;
        row.querySelector(".mossel").textContent = moss;

        /* –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã */
        if (format === "–¢–∞–±–ª–µ—Ç–∫–∞") grinders++;
        if (format === "–ü–æ—Ä–æ—à–æ–∫") spoons++;
        if (format === "–ù–æ–∂–Ω–∏—Ü—ã (—Ñ–∏–∫—Å.)") scissors++;

        /* —Ñ–ª–∞–∫–æ–Ω—ã */
        if (cat === "1.2–ë" || cat === "1.2–ë+2.2") bottles100++;
        else bottles++;

        /* –ø—Ä–æ–±–∏—Ä–∫–∏ */
        if (cat === "4.2") tubes += 3;
    });

    /* –≤—ã–≤–æ–¥ –∏—Ç–æ–≥–æ–≤ */
    document.getElementById("sum_fbr").textContent = totalFBR;
    document.getElementById("sum_tsa").textContent = totalTSA;
    document.getElementById("sum_sda").textContent = totalSDA;
    document.getElementById("sum_tsb").textContent = totalTSB;
    document.getElementById("sum_mossel").textContent = totalMoss;

    document.getElementById("sum_grinders").textContent = grinders;
    document.getElementById("sum_scissors").textContent = scissors;
    document.getElementById("sum_spoons").textContent = spoons;
    document.getElementById("sum_bottles").textContent = bottles;
    document.getElementById("sum_bottles100").textContent = bottles100;
    document.getElementById("sum_tubes").textContent = tubes;
    document.getElementById("sum_racks").textContent = Math.ceil(tubes / 40);
}

/* -------------------- –≠–ö–°–ü–û–†–¢ -------------------- */
function exportExcel() {
    calculateAll();

    let csv =
        "–°—Ä–µ–¥–∞,–º–ª\n" +
        "FBR," + sum_fbr.textContent + "\n" +
        "TSA," + sum_tsa.textContent + "\n" +
        "SDA," + sum_sda.textContent + "\n" +
        "TSB," + sum_tsb.textContent + "\n" +
        "Mossel," + sum_mossel.textContent + "\n\n" +

        "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç,–∫–æ–ª-–≤–æ\n" +
        "–ú–µ–ª—å–Ω–∏—á–∫–∏," + sum_grinders.textContent + "\n" +
        "–ù–æ–∂–Ω–∏—Ü—ã," + sum_scissors.textContent + "\n" +
        "–õ–æ–∂–∫–∏," + sum_spoons.textContent + "\n" +
        "–§–ª–∞–∫–æ–Ω—ã –æ–±—ã—á–Ω—ã–µ," + sum_bottles.textContent + "\n" +
        "–§–ª–∞–∫–æ–Ω—ã 100 –º–ª," + sum_bottles100.textContent + "\n" +
        "–ü—Ä–æ–±–∏—Ä–∫–∏," + sum_tubes.textContent + "\n" +
        "–®—Ç–∞—Ç–∏–≤—ã," + sum_racks.textContent + "\n";

    let blob = new Blob([csv], {type:"text/csv"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "mbch_media_and_tools.csv";
    link.click();
}

</script>
</body>
</html>
/* -------------------------------- */
/*    –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú–´ (–ù–û–í–´–ô)     */
/* -------------------------------- */

.theme-toggle {
    position: absolute;
    left: 0;
    top: 15px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: rgba(0,0,0,0.1);
    color: #333;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ ‚Äî –∏–∫–æ–Ω–∫–∞ —Å–µ—Ä–æ–≤–∞—Ç–∞—è */
body:not(.dark-mode) .theme-toggle {
    background: rgba(0,0,0,0.1);
    color: #444;
    border-color: rgba(0,0,0,0.3);
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ ‚Äî –±–µ–ª–∞—è –∏–∫–æ–Ω–∫–∞ */
body.dark-mode .theme-toggle {
    background: rgba(255,255,255,0.15);
    color: #fff;
    border-color: rgba(255,255,255,0.5);
}

/* –°–∫—Ä—É–≥–ª–µ–Ω–∏—è */
.block, table, button, input, select {
    border-radius: 20px;
}

.block {
    padding: 15px;
    border: 1px solid #ccc;
    margin-bottom: 20px;
    transition: 0.3s;
}

body.dark-mode .block {
    border-color: #555;
}

/* -------------------------------- */
/*        –ü–ï–†–í–ê–Ø –ü–†–û–ë–ê ‚Äî INPUT       */
/* -------------------------------- */

input[type=text] {
    padding: 14px 18px;
    border-radius: 16px;
    border: 1px solid #aaa;
    width: calc(100% - 35px);   /* —É–º–µ–Ω—å—à–µ–Ω–æ –Ω–∞ 35px */
    font-size: 16px;
    text-align: left;
    margin-top: 15px;
    transition: 0.3s;
}

body.dark-mode input[type=text] {
    background: #333;
    border-color: #666;
    color: #fff;
}

input[type=text]::placeholder {
    color: rgba(0,0,0,0.3);
}

body.dark-mode input[type=text]::placeholder {
    color: rgba(255,255,255,0.25);
}

/* –ò–º–µ–Ω–∞ –ø—Ä–æ–± */
input.probe-name {
    width: 120px;
    padding: 6px 10px;
    border-radius: 12px;
    border: 1px solid #aaa;
    text-align: center;
    transition: 0.3s;
}

body.dark-mode input.probe-name {
    background: #333;
    border-color: #666;
    color: #fff;
}

/* -------------------------------- */
/*   –ü–õ–Æ–° / –ú–ò–ù–£–°                   */
/* -------------------------------- */

.counter {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 18px;
}

.counter button {
    width: 28px;
    height: 28px;
    font-size: 18px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.3);
    background: transparent;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}

body.dark-mode .counter button {
    border-color: rgba(255,255,255,0.3);
    color: #f0f0f0;
}

/* -------------------------------- */
/*            –¢–ê–ë–õ–ò–¶–ê               */
/* -------------------------------- */

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
    transition: 0.3s;
}

body.dark-mode th, 
body.dark-mode td {
    border-color: #555;
}

/* –û–¢–°–¢–£–ü –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ –∫–Ω–æ–ø–∫–æ–π */
table + .calculate-btn {
    margin-top: 15px;
}

/* -------------------------------- */
/*       –ö–ù–û–ü–ö–ò                     */
/* -------------------------------- */

button.calculate-btn {
    width: 100%;
    padding: 12px;
    background: #2d7dff;
    color: white;
    border: none;
    font-size: 18px;
    transition: 0.3s;
}

button.export-btn {
    width: 100%;
    padding: 12px;
    background: rgba(0,180,0,0.3);
    color: #004d00;
    border: none;
    font-size: 18px;
    margin-top: 10px;
    transition: 0.3s;
}

body.dark-mode button.export-btn {
    background: rgba(0,255,0,0.18);
    color: #66ff66;
}

/* -------------------------------- */
/*       –ö–†–ï–°–¢–ò–ö                    */
/* -------------------------------- */

.delete-btn {
    background: none;
    border: none;
    color: red;
    font-size: 20px;
    cursor: pointer;
}

body.dark-mode .delete-btn {
    color: #ff6666;
}

/* -------------------------------- */
/*           –ò–¢–û–ì–ò                  */
/* -------------------------------- */

.total-line {
    padding: 3px 0;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid rgba(0,0,0,0.2);
    margin-bottom: 6px;
}

body.dark-mode .total-line {
    border-bottom-color: rgba(255,255,255,0.2);
}

</style>
</head>
<body>

<!-- –ù–æ–≤—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
<button class="theme-toggle" onclick="toggleTheme()">üåô</button>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ä–µ–¥ –ú–ë–ß</h2>

<div class="block">
    <h3 style="text-align:center;">–ü–µ—Ä–≤–∞—è –ø—Ä–æ–±–∞</h3>
    <input type="text" id="firstProbe" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: FP-1856">
</div>

<div class="block">
    <h3 style="text-align:center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±</h3>

    <div class="counter">
        <button onclick="changeCount(-1)">‚àí</button>
        <input type="number" id="sampleCount" value="0" min="0"
               oninput="updateRows()" style="width:60px;text-align:center;font-size:18px;">
        <button onclick="changeCount(1)">+</button>
    </div>
</div>

<table id="samplesTable">
    <thead>
        <tr>
            <th></th>
            <th>#</th>
            <th>–ü—Ä–æ–±–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>1:100</th>
            <th>1:1000</th>
            <th>FBR</th>
            <th>TSA</th>
            <th>SDA</th>
            <th>TSB</th>
            <th>Mossel</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button class="calculate-btn" onclick="calculateAll()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
<button class="export-btn" onclick="exportExcel()">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</button>

<h3 style="margin-top:25px;">–ò–¢–û–ì–û:</h3>

<div class="total-line">FBR <span id="sum_fbr">0</span> –º–ª</div>
<div class="total-line">TSA <span id="sum_tsa">0</span> –º–ª</div>
<div class="total-line">SDA <span id="sum_sda">0</span> –º–ª</div>
<div class="total-line">TSB <span id="sum_tsb">0</span> –º–ª</div>
<div class="total-line">Mossel/MacConkey <span id="sum_mossel">0</span> –º–ª</div>

<script>

/* ---------- THEME SWITCH ---------- */

function toggleTheme() {
    document.body.classList.toggle("dark-mode");

    const btn = document.querySelector(".theme-toggle");
    btn.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
}

/* ---------- –ü–†–û–ë–´ ---------- */

function parseProbeName(name) {
    let match = name.match(/^([A-Za-z]+)-?(\d+)$/);
    if (!match) return null;
    return { prefix: match[1], number: parseInt(match[2]) };
}

function generateProbeName(startName, offset) {
    let parsed = parseProbeName(startName);
    if (!parsed) return startName;
    return parsed.prefix + "-" + (parsed.number + offset);
}

function changeCount(delta) {
    let el = document.getElementById("sampleCount");
    let count = Number(el.value) + delta;
    if (count < 0) count = 0;
    el.value = count;
    updateRows();
}

function updateRows() {
    const tbody = document.querySelector("#samplesTable tbody");
    let target = Number(document.getElementById("sampleCount").value);
    let current = tbody.children.length;

    while (current < target) addRow(current++);
    while (current > target) tbody.removeChild(tbody.lastElementChild), current--;

    renumberRows();
}

function addRow(index) {
    const tbody = document.querySelector("#samplesTable tbody");
    const row = document.createElement("tr");

    let first = document.getElementById("firstProbe").value.trim();
    let generated = first ? generateProbeName(first, index) : "";

    row.innerHTML = `
        <td><button class="delete-btn" onclick="deleteRow(this)">‚úñ</button></td>
        <td class="rownum"></td>
        <td><input type="text" class="probe-name" value="${generated}"></td>

        <td>
            <select class="cat">
                <option value="2.2">2.2</option>
                <option value="3A">3A</option>
                <option value="4.2">4.2</option>
            </select>
        </td>

        <td><input type="checkbox" class="d100"></td>
        <td><input type="checkbox" class="d1000"></td>

        <td class="fbr">0</td>
        <td class="tsa">0</td>
        <td class="sda">0</td>
        <td class="tsb">0</td>
        <td class="mossel">0</td>
    `;
    tbody.appendChild(row);
}

function deleteRow(btn) {
    btn.closest("tr").remove();
    renumberRows();
    document.getElementById("sampleCount").value =
        document.querySelector("#samplesTable tbody").children.length;
}

function renumberRows() {
    document.querySelectorAll("#samplesTable tbody tr").forEach((row, i) => {
        row.querySelector(".rownum").textContent = i + 1;
    });
}

/* ---------- –†–ê–°–ß–Å–¢ ---------- */

function calculateAll() {
    const rows = document.querySelectorAll("#samplesTable tbody tr");

    let FBR=0, TSA=0, SDA=0, TSB=0, Mossel=0;

    rows.forEach(row => {
        const cat = row.querySelector(".cat").value;
        const d100 = row.querySelector(".d100").checked;
        const d1000 = row.querySelector(".d1000").checked;

        let fbr = 90 + (d100 ? 90 : 0) + (d1000 ? 90 : 0);
        let tsa = 25;
        let sda = 25;
        let tsb = (cat === "4.2" ? 190 : 100);
        let moss = (cat === "4.2" ? 27 : 0);

        row.querySelector(".fbr").textContent = fbr;
        row.querySelector(".tsa").textContent = tsa;
        row.querySelector(".sda").textContent = sda;
        row.querySelector(".tsb").textContent = tsb;
        row.querySelector(".mossel").textContent = moss;

        FBR += fbr;
        TSA += tsa;
        SDA += sda;
        TSB += tsb;
        Mossel += moss;
    });

    sum_fbr.textContent = FBR;
    sum_tsa.textContent = TSA;
    sum_sda.textContent = SDA;
    sum_tsb.textContent = TSB;
    sum_mossel.textContent = Mossel;
}

/* ---------- –≠–ö–°–ü–û–†–¢ ---------- */

function exportExcel() {
    calculateAll();

    let csv =
        "–°—Ä–µ–¥–∞,–º–ª\n" +
        "FBR," + sum_fbr.textContent + "\n" +
        "TSA," + sum_tsa.textContent + "\n" +
        "SDA," + sum_sda.textContent + "\n" +
        "TSB," + sum_tsb.textContent + "\n" +
        "Mossel/MacConkey," + sum_mossel.textContent + "\n";

    let blob = new Blob([csv], {type:"text/csv"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "media_consumption.csv";
    link.click();
}

</script>
</body>
</html>



